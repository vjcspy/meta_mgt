<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <virtualType name="IzRetailReader" type="Magento\Framework\Config\Reader\Filesystem">
        <arguments>
            <argument name="converter" xsi:type="object">ChiakiApi\ApiBase\Model\IzRetailConfig\Converter</argument>
            <argument name="schemaLocator" xsi:type="object">ChiakiApi\ApiBase\Model\IzRetailConfig\SchemaLocator
            </argument>
            <argument name="fileName" xsi:type="string">chiaki_api.xml</argument>

            <!-- this is important to specify so merging can properly happen -->
            <argument name="idAttributes" xsi:type="array">
                <item name="/config/actions/action" xsi:type="string">type</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="IzRetailData" type="\Magento\Framework\Config\Data">
        <arguments>
            <argument name="cacheId" xsi:type="string">iz_retail_cache</argument>
            <argument name="reader" xsi:type="object">IzRetailReader</argument>
        </arguments>
    </virtualType>
    <type name="ChiakiApi\ApiBase\Model\IzRetailConfig">
        <arguments>
            <argument name="configData" xsi:type="object">IzRetailData</argument>
        </arguments>
    </type>

    <!--    Console-->

    <type name="Magento\Framework\Console\CommandListInterface">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="iz_retail_config" xsi:type="object">
                    ChiakiApi\ApiBase\Consoles\Config
                </item>
            </argument>
        </arguments>
    </type>

    <!--   START ________________ Override default behavior of magento RestAPi-->

    <preference for="ChiakiApi\ApiBase\Api\Data\IzRetailActionInterface"
                type="ChiakiApi\ApiBase\Model\Data\IzRetailAction"/>

    <preference for="ChiakiApi\ApiBase\Api\Data\IzRetailResponseInterface"
                type="ChiakiApi\ApiBase\Model\Data\IzRetailResponse"/>

    <preference for="ChiakiApi\ApiBase\Api\Data\IzRetailDataInterface"
                type="ChiakiApi\ApiBase\Model\Data\IzRetailData"/>

    <!-- Convert Output data to array-->
    <type name="Magento\Framework\Webapi\ServiceOutputProcessor">
        <plugin name="iz_convert_api_data"
                type="ChiakiApi\ApiBase\Plugin\Magento\Framework\Webapi\ServiceOutputProcessor\Plugin"
                sortOrder="100"/>
    </type>

    <!-- Convert Input payload data to array-->
    <type name="Magento\Framework\Webapi\ServiceInputProcessor">
        <plugin name="iz_convert_api_data"
                type="ChiakiApi\ApiBase\Plugin\Magento\Framework\Webapi\ServiceInputProcessor\Plugin"
                sortOrder="100"/>
    </type>

    <!-- Generate response 200 include data key in array-->
    <preference for="Magento\Framework\Webapi\Rest\Response"
                type="ChiakiApi\ApiBase\Preference\Magento\Framework\Webapi\Rest\Response"/>

    <!--   END ________________ Override default behavior of magento RestAPi-->

    <preference for="ChiakiApi\ApiBase\Api\IzRetailApiResolverInterface"
                type="ChiakiApi\ApiBase\Model\ApiResolver"/>
</config>
